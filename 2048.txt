#include<iostream>
#include<conio.h>
#include<string>
#include<time.h>

using namespace std;

int main()
{
    int row,col,i,j,a,b,c,d,val,pos,score=0,y,con,key,p,q,r,s,o;
    cout<<"enter rows and cols";
    cin>>row>>col;
    int **cptr;
    int **bptr;
    int **ptr;
    ptr=new int*[row];
    cptr=new int*[row];
    bptr=new int*[row];
    for(i=0;i<row;i++)
    {
        ptr[i]=new int[col];
        cptr[i]=new int[col];
        bptr[i]=new int[col];
    }
    for(i=0;i<row;i++)
    {
        for(j=0;j<col;j++)
        {
            *(*(ptr+i)+j)=0;
        }
    }
    srand(time(0));
    a=rand()%row;
    b=rand()%col;
    *(*(ptr+a)+b)=2;
    a=rand()%row;
    b=rand()%col;
    *(*(ptr+a)+b)=2;
    p=0;
    q=0;
    r=0;
    s=0;
    while(true)
    {
        for(i=0;i<row;i++)
        {
            for(j=0;j<col;j++)
            {
                cout<<*(*(ptr+i)+j)<<"\t";
            }
            cout<<"\n";
        }
        cout<<"SCORE:- "<<score<<"\n";
        cout<<"PRESS ARROW KEY(UP,LEFT,RIGHT,DOWN)"<<"\n";
        cout<<"PRESS 'U' FOR UNDO";
	    key=getch();
	    system("CLS");
        if(key==117)
        {
            if(o==0)
            {
                for(i=0;i<row;i++)
                {
                    for(j=0;j<col;j++)
                    {
                        *(*(ptr+i)+j)=*(*(cptr+i)+j);
                    }
                }
            }
            else
            {
                for(i=0;i<row;i++)
                {
                    for(j=0;j<col;j++)
                    {
                        *(*(ptr+i)+j)=*(*(bptr+i)+j);
                    }
                }
            }
            score-=d;
            d=0;
        }
        if(key==224)
        {
            do
            {
                key=getch();
            }while(key==224);
            for(i=0;i<row;i++)
            {
                for(j=0;j<col;j++)
                {
                    *(*(cptr+i)+j)=*(*(ptr+i)+j);
                }
            }
            if(key==72)
            {
                d=0;
                for(j=0;j<col;j++)
                {
                    val=*(*(ptr)+j);
                    pos=0;
                    con=0;
                    for(i=1;i<row;i++)
                    {
                        if(val!=0)
                        {
                            if(*(*(ptr+i)+j)==val && con==0)
                            {
                                *(*(ptr+pos)+j)*=2;
                                val=*(*(ptr+pos)+j);
                                d+=*(*(ptr+pos)+j);
                                score+=*(*(ptr+pos)+j);
                                *(*(ptr+i)+j)=0;
                                con=1;
                            }
                            else if(*(*(ptr+i)+j)!=0)
                            {
                                val=*(*(ptr+i)+j);
                                *(*(ptr+i)+j)=0;
                                *(*(ptr+pos+1)+j)=val;
                                pos+=1;
                                con=0;
                            }
                            else
                            {
                                continue;
                            }
                        }
                        else
                        {
                            if(*(*(ptr+i)+j)!=0)
                            {
                                *(*(ptr+pos)+j)=*(*(ptr+i)+j);
                                val=*(*(ptr+i)+j);
                                *(*(ptr+i)+j)=0;
                            }
                            else
                            {
                                continue;
                            }
                        }
                    }
                }
                o=1;
                for(i=0;i<row;i++)
                {
                    for(j=0;j<col;j++)
                    {
                        if(*(*(ptr+i)+j)!=*(*(cptr+i)+j))
                        {
                            o=0;
                            break;
                        }
                    }
                    if(o==0)
                    {
                        break;
                    }
                }
                if(o==1)
                {
                    p=1;
                }
                else
                {
                    s=0;
                    p=0;
                    q=0;
                    r=0;
                }
            }
            else if(key==75)
            {
                d=0;
                for(i=0;i<row;i++)
                {
                    val=*(*(ptr+i));
                    pos=0;
                    con=0;
                    for(j=1;j<col;j++)
                    {
                        if(val!=0)
                        {
                            if(*(*(ptr+i)+j)==val && con==0)
                            {
                                *(*(ptr+i)+pos)*=2;
                                val=*(*(ptr+i)+pos);
                                d+=*(*(ptr+i)+pos);
                                score+=*(*(ptr+i)+pos);
                                *(*(ptr+i)+j)=0;
                                con=1;
                            }
                            else if(*(*(ptr+i)+j)!=0)
                            {
                                val=*(*(ptr+i)+j);
                                *(*(ptr+i)+j)=0;
                                *(*(ptr+i)+pos+1)=val;
                                pos+=1;
                                con=0;
                            }
                            else
                            {
                                continue;
                            }
                        }
                        else
                        {
                            if(*(*(ptr+i)+j)!=0)
                            {
                                *(*(ptr+i)+pos)=*(*(ptr+i)+j);
                                val=*(*(ptr+i)+j);
                                *(*(ptr+i)+j)=0;
                            }
                            else
                            {
                                continue;
                            }
                        }
                    }
                }
                o=1;
                for(i=0;i<row;i++)
                {
                    for(j=0;j<col;j++)
                    {
                        if(*(*(ptr+i)+j)!=*(*(cptr+i)+j))
                        {
                            o=0;
                            break;
                        }
                    }
                    if(o==0)
                    {
                        break;
                    }
                }
                if(o==1)
                {
                    q=1;
                }
                else
                {
                    s=0;
                    p=0;
                    q=0;
                    r=0;
                }
            }
            else if(key==80)
            {
                d=0;
                for(j=0;j<col;j++)
                {
                    val=*(*(ptr+row-1)+j);
                    pos=row-1;
                    con=0;
                    for(i=row-2;i>=0;i--)
                    {
                        if(val!=0)
                        {
                            if(*(*(ptr+i)+j)==val && con==0)
                            {
                                *(*(ptr+pos)+j)*=2;
                                val=*(*(ptr+pos)+j);
                                d+=*(*(ptr+pos)+j);
                                score+=*(*(ptr+pos)+j);
                                *(*(ptr+i)+j)=0;
                                con=1;
                            }
                            else if(*(*(ptr+i)+j)!=0)
                            {
                                val=*(*(ptr+i)+j);
                                *(*(ptr+i)+j)=0;
                                *(*(ptr+pos-1)+j)=val;
                                pos-=1;
                                con=0;
                            }
                            else
                            {
                                continue;
                            }
                        }
                        else
                        {
                            if(*(*(ptr+i)+j)!=0)
                            {
                                *(*(ptr+pos)+j)=*(*(ptr+i)+j);
                                val=*(*(ptr+i)+j);
                                *(*(ptr+i)+j)=0;
                            }
                            else
                            {
                                continue;
                            }
                        }
                    }
                }
                o=1;
                for(i=0;i<row;i++)
                {
                    for(j=0;j<col;j++)
                    {
                        if(*(*(ptr+i)+j)!=*(*(cptr+i)+j))
                        {
                            o=0;
                            break;
                        }
                    }
                    if(o==0)
                    {
                        break;
                    }
                }
                if(o==1)
                {
                    r=1;
                }
                else
                {
                    s=0;
                    p=0;
                    q=0;
                    r=0;
                }
            }
            else if(key==77)
            {
                d=0;
                for(i=0;i<row;i++)
                {
                    val=*(*(ptr+i)+col-1);
                    pos=col-1;
                    con=0;
                    for(j=col-2;j>=0;j--)
                    {
                        if(val!=0)
                        {
                            if(*(*(ptr+i)+j)==val && con==0)
                            {
                                *(*(ptr+i)+pos)*=2;
                                val=*(*(ptr+i)+pos);
                                d+=*(*(ptr+i)+pos);
                                score+=*(*(ptr+i)+pos);
                                *(*(ptr+i)+j)=0;
                                con=1;
                            }
                            else if(*(*(ptr+i)+j)!=0)
                            {
                                val=*(*(ptr+i)+j);
                                *(*(ptr+i)+j)=0;
                                *(*(ptr+i)+pos-1)=val;
                                pos-=1;
                                con=0;
                            }
                            else
                            {
                                continue;
                            }
                        }
                        else
                        {
                            if(*(*(ptr+i)+j)!=0)
                            {
                                *(*(ptr+i)+pos)=*(*(ptr+i)+j);
                                val=*(*(ptr+i)+j);
                                *(*(ptr+i)+j)=0;
                            }
                            else
                            {
                                continue;
                            }
                        }
                    }
                }
                o=1;
                for(i=0;i<row;i++)
                {
                    for(j=0;j<col;j++)
                    {
                        if(*(*(ptr+i)+j)!=*(*(cptr+i)+j))
                        {
                            o=0;
                            break;
                        }
                    }
                    if(o==0)
                    {
                        break;
                    }
                }
                if(o==1)
                {
                    s=1;
                }
                else
                {
                    s=0;
                    p=0;
                    q=0;
                    r=0;
                }
            }
            if(o==0)
            {
                for(i=0;i<row;i++)
                {
                    for(j=0;j<col;j++)
                    {
                        *(*(bptr+i)+j)=*(*(cptr+i)+j);
                    }
                }
            }
            if(o==0 && (key==72 || key==75 || key==77 || key==80))
            {
                a=rand()%row;
                b=rand()%col;
                c=rand()%4;
                y=0;
                if(*(*(ptr+a)+b)==0)
                {
                    if(c==0)
                    {
                        *(*(ptr+a)+b)=4;
                    }
                    else
                    {
                        *(*(ptr+a)+b)=2;
                    }
                }
                else
                {
                    for(i=0;i<row;i++)
                    {
                        for(j=0;j<col;j++)
                        {
                            if(*(*(ptr+i)+j)==0)
                            {
                                if(c==0)
                                {
                                    *(*(ptr+i)+j)=4;
                                    y=1;
                                    break;
                                }
                                else
                                {
                                    *(*(ptr+i)+j)=2;
                                    y=1;
                                    break;
                                }
                            }
                        }
                        if(y==1)
                        {
                            break;
                        }
                    }
                }
            }
        }
        if(p==1 && r==1 && q==1 && s==1)
        {
            system("CLS");
            for(i=0;i<row;i++)
            {
                for(j=0;j<col;j++)
                {
                    cout<<*(*(ptr+i)+j)<<"\t";
                }
                cout<<"\n";
            }
            cout<<"GAME OVER,YOU SCORED "<<score<<" POINTS";
            break;
        }
    }
    return 0;
}
